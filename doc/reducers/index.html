<!DOCTYPE html><html lang="en"><head><title>reducers/index</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="reducers/index"><meta name="groc-project-path" content="src/reducers/index.ts"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/reducers/index.ts</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="root-reducer">Root reducer</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> { combineReducers } from <span class="hljs-string">'redux'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Reducer } from <span class="hljs-string">'redux'</span>
<span class="hljs-keyword">import</span> reduceReducers from <span class="hljs-string">'reduce-reducers'</span>

<span class="hljs-keyword">import</span> config from <span class="hljs-string">'./config'</span>
<span class="hljs-keyword">import</span> currentUser from <span class="hljs-string">'./currentUser'</span>
<span class="hljs-keyword">import</span> goals from <span class="hljs-string">'./goals'</span>
<span class="hljs-keyword">import</span> history from <span class="hljs-string">'./history'</span>
<span class="hljs-keyword">import</span> reduceCloseDay from <span class="hljs-string">'./closeDay'</span>
<span class="hljs-keyword">import</span> today from <span class="hljs-string">'./today'</span>
<span class="hljs-keyword">import</span> todaysProgress from <span class="hljs-string">'./todaysProgress'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Following <a href="https://redux.js.org/usage/structuring-reducers/splitting-reducer-logic">Redux best
practices</a>,
we&#39;ll use <a href="https://redux.js.org/api/combinereducers"><code>combineReducers</code></a> to
aggregate our slice reducers into one higher-level one that will delegate
automatically to ours on a slice-by-slice basis.</p>
<p>However, noe action (<code>closeDay</code>) is not slice-specific, but root-level (it
touches on <code>today</code>, <code>todaysProgress</code> and <code>history</code>), so we need to handle it
through a root-level reducer  (<code>reduceCloseDay</code>).</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Let&#39;s first consolidate our “core” root reducer…</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> coreReducer = combineReducers({</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>…based on our individual slice reducers.</p></div></div><div class="code"><div class="wrapper">  config,
  currentUser,
  goals,
  history,
  today,
  todaysProgress,
})</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To avoid circular definition issues with auto-defined / inferred types in TS
and Redux-Toolkit, we&#39;ll define <code>RootState</code> based not on our final reducer,
but on the core combined reducer (the types are structurally identical).</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> RootState = ReturnType&lt;<span class="hljs-keyword">typeof</span> coreReducer&gt;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Then we&#39;ll define the final reducer exported by this module, that will be the
one used in the Redux store to process all our actions.  Reduce-Reducers
doesn&#39;t do so well on typing, so we need explicit typing on the result
reducer to meet our expectations.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> goalTrackerReducer = reduceReducers(
  coreReducer,
  reduceCloseDay
) as Reducer&lt;RootState&gt;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Other possible implementations:</p>
<h2 id="naive-hardcoded-variant">Naive, hardcoded variant</h2>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goalTrackerReducer</span>(<span class="hljs-params">state, action</span>) </span>{
  state = coreReducer(state, action)
  state = closeDay(state, action)
  <span class="hljs-keyword">return</span> state
}</code></pre>
<h2 id="a-bit-more-generic-variant">A-bit-more-generic variant</h2>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goalTrackerReducer</span>(<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> reducer <span class="hljs-keyword">of</span> [coreReducer, closeDay]) {
    state = reducer(state, action)
  }
  <span class="hljs-keyword">return</span> state
}</code></pre>
<h2 id="handwritten-legit-reduce-">Handwritten, legit <code>reduce</code></h2>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goalTrackerReducer</span>(<span class="hljs-params">state, action</span>) </span>{
  <span class="hljs-keyword">return</span> [coreReducer, closeDay].reduce(
    (prev, reducer) =&gt; reducer(prev, action),
    state
  )
}</code></pre></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> goalTrackerReducer</div></div></div></div></body></html>