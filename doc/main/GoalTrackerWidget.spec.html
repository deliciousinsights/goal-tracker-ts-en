<!DOCTYPE html><html lang="en"><head><title>main/GoalTrackerWidget.spec</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="main/GoalTrackerWidget.spec"><meta name="groc-project-path" content="src/main/GoalTrackerWidget.spec.tsx"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/main/GoalTrackerWidget.spec.tsx</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="goal-progress-for-today-tests">Goal progress for today (tests)</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> { render, screen } from <span class="hljs-string">'@testing-library/react'</span>
<span class="hljs-keyword">import</span> userEvent from <span class="hljs-string">'@testing-library/user-event'</span>

<span class="hljs-keyword">import</span> GoalTrackerWidget from <span class="hljs-string">'./GoalTrackerWidget'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>It&#39;s customary when describing a React component to use its JSX tag as the
subject. This one should…</p></div></div><div class="code"><div class="wrapper">describe(<span class="hljs-string">'&lt;GoalTrackerWidget /&gt;'</span>, () =&gt; {
  <span class="hljs-keyword">const</span> goal = {
    id: <span class="hljs-string">'0123456789abcdef01234567'</span>,
    name: <span class="hljs-string">'My goal'</span>,
    target: <span class="hljs-number">42</span>,
    units: <span class="hljs-string">'wombats'</span>,
  }
  describe(<span class="hljs-string">'when not completed'</span>, () =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="render-as-expected-for-an-unreached-goal">…render as expected for an unreached goal</h2>
<p>We&#39;ll test four values for rate of completion: “boundaries” such as 0, 1
and 41 on the one hand; and another value, here 21 smack in the midddle,
on the other hand.</p></div></div><div class="code"><div class="wrapper">    it.each`
      progress | percentage
      ${<span class="hljs-number">0</span>}     | ${<span class="hljs-number">0</span>}
      ${<span class="hljs-number">1</span>}     | ${<span class="hljs-number">2</span>}
      ${<span class="hljs-number">21</span>}    | ${<span class="hljs-number">50</span>}
      ${<span class="hljs-number">41</span>}    | ${<span class="hljs-number">98</span>}
    `(
      <span class="hljs-string">'should render appropriately at progress $progress'</span>,
      ({ progress, percentage }) =&gt; {
        render(&lt;GoalTrackerWidget goal={goal} progress={progress} /&gt;)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The heading component (h1, h2 or some other) should contain exactly
the name of the goal.</p></div></div><div class="code"><div class="wrapper">        expect(screen.getByRole(<span class="hljs-string">'heading'</span>)).toHaveTextContent(goal.name)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The component with a progressbar ARIA role (which is created
internally by the <code>&lt;LinearProgress/&gt;</code> used in <code>&lt;Gauge/&gt;</code>) should have
the correct ARIA progress attribute.  This is cleaner than checking
for derived styling / dimensions, etc.</p></div></div><div class="code"><div class="wrapper">        expect(screen.getByRole(<span class="hljs-string">'progressbar'</span>)).toHaveAttribute(
          <span class="hljs-string">'aria-valuenow'</span>,
          <span class="hljs-built_in">String</span>(percentage)
        )</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>There should be this specific text somewhere in there for context.</p></div></div><div class="code"><div class="wrapper">        expect(
          screen.getByText(`${progress} out of ${goal.target} ${goal.units}`)
        ).toBeInTheDocument()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Sometimes components cannot be targeted in a meaningful way by RTL&#39;s
built-in selectors, because how how they&#39;re implemented React-wise.
For such scenarios, we have the <code>data-testid</code> prop escape hatch.  It
so happens that MUI&#39;s icons do have that set to their icon name, but
it is less semantical / resilient to change than meaningful values,
so we provided our own here.</p></div></div><div class="code"><div class="wrapper">        expect(screen.getByTestId(<span class="hljs-string">'in-progress'</span>)).toBeInTheDocument()
      }
    )</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="-trigger-its-onprogress-as-expected">…trigger its <code>onProgress</code> as expected</h2></div></div><div class="code"><div class="wrapper">    it(<span class="hljs-string">'should trigger its onProgress on click'</span>, async () =&gt; {
      <span class="hljs-keyword">const</span> progress = <span class="hljs-number">21</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>To verify that the provided callback is called correctly, the simplest
way is to go with a spy provided by
<a href="https://jestjs.io/docs/en/jest-object#mock-functions">jest.fn()</a>.</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">const</span> onProgress = jest.fn()
      render(
        &lt;GoalTrackerWidget
          goal={goal}
          onProgress={onProgress}
          progress={progress}
        /&gt;
      )</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Faithfully simulate the click.</p></div></div><div class="code"><div class="wrapper">      await userEvent.click(screen.getByRole(<span class="hljs-string">'button'</span>))
      expect(onProgress).toHaveBeenCalledTimes(<span class="hljs-number">1</span>)
      expect(onProgress).toHaveBeenCalledWith(goal)
    })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="satisfy-the-snapshot">…satisfy the snapshot</h2>
<p>(It should have a detailed structure that is identical to the last one
vetted by developers using the snapshot.)</p></div></div><div class="code"><div class="wrapper">    it(<span class="hljs-string">'should otherwise match the expected snapshot'</span>, () =&gt; {
      <span class="hljs-keyword">const</span> { container } = render(
        &lt;GoalTrackerWidget goal={goal} progress={<span class="hljs-number">21</span>} /&gt;
      )

      expect(container).toMatchSnapshot()
    })
  })

  describe(<span class="hljs-string">'when completed (or exceeded)'</span>, () =&gt; {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="render-as-expected-for-a-reached-or-exceeded-goal">…render as expected for a reached (or exceeded) goal</h2>
<p>We&#39;ll test 3 values for the progress: the boundary (exact target), and
two higher ones (goal exceeded).</p></div></div><div class="code"><div class="wrapper">    it.each([goal.target, goal.target + <span class="hljs-number">1</span>, goal.target + <span class="hljs-number">10</span>])(
      <span class="hljs-string">'should render appropriately at progress %i'</span>,
      (progress) =&gt; {
        render(&lt;GoalTrackerWidget goal={goal} progress={progress} /&gt;)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If we reached or exceeded the goal, we&#39;re not supposed to still see
the &quot;progress on&quot; icon, but instead should see the thumbs-up icon
that marks the goal as being reached.</p></div></div><div class="code"><div class="wrapper">        expect(screen.queryByTestId(<span class="hljs-string">'in-progress'</span>)).not.toBeInTheDocument()
        expect(screen.getByTestId(<span class="hljs-string">'completed'</span>)).toBeInTheDocument()
      }
    )</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="satisfy-the-snapshot">…satisfy the snapshot</h2>
<p>(It should have a detailed structure that is identical to the last one
vetted by developers using the snapshot.)</p></div></div><div class="code"><div class="wrapper">    it(<span class="hljs-string">'should otherwise match the expected snapshot'</span>, () =&gt; {
      <span class="hljs-keyword">const</span> { container } = render(
        &lt;GoalTrackerWidget goal={goal} progress={<span class="hljs-number">42</span>} /&gt;
      )

      expect(container).toMatchSnapshot()
    })
  })
})</div></div></div></div></body></html>