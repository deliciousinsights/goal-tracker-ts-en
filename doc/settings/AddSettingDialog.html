<!DOCTYPE html><html lang="en"><head><title>settings/AddSettingDialog</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="settings/AddSettingDialog"><meta name="groc-project-path" content="src/settings/AddSettingDialog.tsx"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/settings/AddSettingDialog.tsx</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="addupdate-goal-dialog">Add/Update Goal Dialog</h1></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is always included in the Settings screen, so can be &quot;rendered&quot; with a
nullish or empty goal.  Its props get updated as the screen changes which
goal it operates on (an existing goal will have an <code>id</code> property).</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { ChangeEvent } from <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useState } from <span class="hljs-string">'react'</span>

<span class="hljs-keyword">import</span> Add from <span class="hljs-string">'@mui/icons-material/Add'</span>
<span class="hljs-keyword">import</span> Button from <span class="hljs-string">'@mui/material/Button'</span>
<span class="hljs-keyword">import</span> Checkbox from <span class="hljs-string">'@mui/material/Checkbox'</span>
<span class="hljs-keyword">import</span> Dialog from <span class="hljs-string">'@mui/material/Dialog'</span>
<span class="hljs-keyword">import</span> DialogActions from <span class="hljs-string">'@mui/material/DialogActions'</span>
<span class="hljs-keyword">import</span> DialogContent from <span class="hljs-string">'@mui/material/DialogContent'</span>
<span class="hljs-keyword">import</span> DialogTitle from <span class="hljs-string">'@mui/material/DialogTitle'</span>
<span class="hljs-keyword">import</span> Edit from <span class="hljs-string">'@mui/icons-material/Create'</span>
<span class="hljs-keyword">import</span> FormControlLabel from <span class="hljs-string">'@mui/material/FormControlLabel'</span>
<span class="hljs-keyword">import</span> FormGroup from <span class="hljs-string">'@mui/material/FormGroup'</span>
<span class="hljs-keyword">import</span> TextField from <span class="hljs-string">'@mui/material/TextField'</span>
<span class="hljs-keyword">import</span> useMediaQuery from <span class="hljs-string">'@mui/material/useMediaQuery'</span>

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Goal } from <span class="hljs-string">'../reducers/goals'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The callback passed by the parent component for <code>onAdd</code> might need a type for
its argument (e.g. if it&#39;s not inlined), so we export that.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-interface"><span class="hljs-keyword">interface</span> ASDState </span>{
  id?: <span class="hljs-built_in">string</span>
  name: <span class="hljs-built_in">string</span>
  target: <span class="hljs-built_in">number</span>
  units: <span class="hljs-built_in">string</span>
  keepOpen?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">const</span> DEFAULT_STATE: ASDState = {
  id: <span class="hljs-literal">undefined</span>,
  name: <span class="hljs-string">''</span>,
  target: <span class="hljs-number">5</span>,
  units: <span class="hljs-string">''</span>,
  keepOpen: <span class="hljs-literal">true</span>,
}

<span class="hljs-interface"><span class="hljs-keyword">interface</span> ASDProps </span>{
  goal: Goal | { id?: <span class="hljs-built_in">string</span> }
  onAdd: (state: ASDState) =&gt; <span class="hljs-built_in">void</span>
  onCancel: () =&gt; <span class="hljs-built_in">void</span>
  onClosed?: () =&gt; <span class="hljs-built_in">void</span>
  open: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AddSettingDialog</span>(<span class="hljs-params">{
  goal,
  onAdd,
  onCancel,
  onClosed,
  open,
}: ASDProps</span>) </span>{
  <span class="hljs-keyword">const</span> smallViewport = useMediaQuery(<span class="hljs-string">'(max-width: 480px)'</span>)
  <span class="hljs-keyword">const</span> [state, setState] = useState&lt;ASDState&gt;({ ...DEFAULT_STATE, ...goal })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If the passed goal has an <code>id</code> property, it&#39;s an existing goal and we&#39;re
editing it, otherwise it&#39;s a fresh goal and we&#39;re adding it.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> isEditing = <span class="hljs-string">'id'</span> <span class="hljs-keyword">in</span> goal

  <span class="hljs-keyword">return</span> (
    &lt;Dialog
      aria-labelledby=<span class="hljs-string">'addGoalTitle'</span>
      fullScreen={smallViewport}
      onClose={onCancel}
      open={open}
      TransitionProps={{
        onExited: onClosed,
      }}
    &gt;
      &lt;DialogTitle id=<span class="hljs-string">'addGoalTitle'</span>&gt;
        {isEditing ? <span class="hljs-string">'Edit a goal'</span> : <span class="hljs-string">'Add a goal'</span>}
      &lt;<span class="hljs-regexp">/DialogTitle&gt;
      &lt;DialogContent&gt;
        &lt;TextField
          fullWidth
          label='Name'
          margin='normal'
          name='name'
          onChange={(event) =&gt; handleChange(event, 'name')}
          required
          value={state.name}
        /</span>&gt;
        &lt;TextField
          label=<span class="hljs-string">'Daily target'</span>
          margin=<span class="hljs-string">'normal'</span>
          name=<span class="hljs-string">'target'</span>
          onChange={(event) =&gt; handleChange(event, <span class="hljs-string">'target'</span>)}
          required
          <span class="hljs-keyword">type</span>=<span class="hljs-string">'number'</span>
          value={state.target}
        /&gt;{<span class="hljs-string">' '</span>}
        &lt;TextField
          label=<span class="hljs-string">'Unit'</span>
          margin=<span class="hljs-string">'normal'</span>
          name=<span class="hljs-string">'units'</span>
          onChange={(event) =&gt; handleChange(event, <span class="hljs-string">'units'</span>)}
          placeholder=<span class="hljs-string">'steps, minutes…'</span>
          required
          value={state.units}
        /&gt;
        {isEditing || (
          &lt;FormGroup&gt;
            &lt;FormControlLabel
              control={
                &lt;Checkbox
                  checked={state.keepOpen}
                  onChange={(event, checked) =&gt;
                    handleChange(event, <span class="hljs-string">'keepOpen'</span>, checked)
                  }
                /&gt;
              }
              label=<span class="hljs-string">'Keep open for the next add'</span>
            /&gt;
          &lt;<span class="hljs-regexp">/FormGroup&gt;
        )}
      &lt;/</span>DialogContent&gt;
      &lt;DialogActions&gt;
        &lt;Button color=<span class="hljs-string">'secondary'</span> onClick={onCancel} variant=<span class="hljs-string">'text'</span>&gt;
          Cancel
        &lt;<span class="hljs-regexp">/Button&gt;
        {isEditing ? (
          &lt;Button
            color='primary'
            onClick={triggerAdd}
            startIcon={&lt;Edit /</span>&gt;}
            variant=<span class="hljs-string">'text'</span>
          &gt;
            Edit
          &lt;<span class="hljs-regexp">/Button&gt;
        ) : (
          &lt;Button
            color='primary'
            onClick={triggerAdd}
            startIcon={&lt;Add /</span>&gt;}
            variant=<span class="hljs-string">'text'</span>
          &gt;
            Add
          &lt;<span class="hljs-regexp">/Button&gt;
        )}
      &lt;/</span>DialogActions&gt;
    &lt;<span class="hljs-regexp">/Dialog&gt;
  )
</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Generic field change handler that stores the field&#39;s value (which, coming
from the DOM, is always a <code>String</code>) into the correct <code>state</code> property, with
on-the-fly conversion when applicable.</p>
<p>There is a special case for check boxes, who need that third argument as
we&#39;re not focusing on value but on checked state.</p>
<p>This is an interesting bit of code, as it demonstrates:</p>
<ul>
<li>Dynamic function selection (<code>Number</code> or <code>String</code>)</li>
<li>Computed Property Names (<code>[field]: …</code>), part of ES2015 Shorthands</li>
<li>Object spread (<code>...state</code>), as the function returned by <code>useState</code> isn&#39;t
for partial updates but for full replacements, unlike the legacy
<code>React.Component#setState(…)</code> behavior.</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleChange</span>(<span class="hljs-params"></span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Les joies du typage de gestionnaire d&#39;événements en React…</p></div></div><div class="code"><div class="wrapper">    event: ChangeEvent&lt;HTMLInputElement | HTMLTextAreaElement&gt;,
    field: <span class="hljs-built_in">string</span>,
    checked?: <span class="hljs-built_in">boolean</span>
  ) {
    <span class="hljs-keyword">if</span> (field === <span class="hljs-string">'keepOpen'</span>) {
      setState({ ...state, keepOpen: checked })
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">const</span> caster = field === <span class="hljs-string">'target'</span> ? <span class="hljs-built_in">Number</span> : <span class="hljs-built_in">String</span>
      setState({ ...state, [field]: caster(event.target.value) })
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">triggerAdd</span>(<span class="hljs-params"></span>) </span>{
    onAdd(state)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We reset the state only if we intend on keeping the dialog open for
further addition; otherwise it would alter the general aspect during the
closing fade-out, which is visually annoying.</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> (state.keepOpen) {
      setState(DEFAULT_STATE)
    }
  }
}</div></div></div></div></body></html>