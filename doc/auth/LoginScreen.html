<!DOCTYPE html><html lang="en"><head><title>auth/LoginScreen</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="auth/LoginScreen"><meta name="groc-project-path" content="src/auth/LoginScreen.tsx"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/auth/LoginScreen.tsx</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="login-screen">Login Screen</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { FormEvent } from <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useEffect, useState } from <span class="hljs-string">'react'</span>

<span class="hljs-keyword">import</span> ArrowForward from <span class="hljs-string">'@mui/icons-material/ArrowForward'</span>
<span class="hljs-keyword">import</span> Button from <span class="hljs-string">'@mui/material/Button'</span>
<span class="hljs-keyword">import</span> Card from <span class="hljs-string">'@mui/material/Card'</span>
<span class="hljs-keyword">import</span> CardActions from <span class="hljs-string">'@mui/material/CardActions'</span>
<span class="hljs-keyword">import</span> CardContent from <span class="hljs-string">'@mui/material/CardContent'</span>
<span class="hljs-keyword">import</span> CardHeader from <span class="hljs-string">'@mui/material/CardHeader'</span>
<span class="hljs-keyword">import</span> Snackbar from <span class="hljs-string">'@mui/material/Snackbar'</span>
<span class="hljs-keyword">import</span> TextField from <span class="hljs-string">'@mui/material/TextField'</span>

<span class="hljs-keyword">import</span> classes from <span class="hljs-string">'./LoginScreen.module.css'</span>
<span class="hljs-keyword">import</span> { logIn } from <span class="hljs-string">'../reducers/currentUser'</span>
<span class="hljs-keyword">import</span> TogglablePasswordField from <span class="hljs-string">'./TogglablePasswordField'</span>
<span class="hljs-keyword">import</span> { useAppDispatch, useAppSelector } from <span class="hljs-string">'../store'</span>

<span class="hljs-keyword">const</span> MIN_PASSWORD_LENGTH = <span class="hljs-number">6</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">LoginScreen</span>(<span class="hljs-params"></span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>At first render, we adjust the document title to make the browsing history
usable (and not a ton of identical titles).  The <a href="https://beta.reactjs.org/learn/synchronizing-with-effects#step-2-specify-the-effect-dependencies">second
argument</a>
is an empty dependency list that tells React only to run the side effect at
mount time.</p></div></div><div class="code"><div class="wrapper">  useEffect(() =&gt; {
    <span class="hljs-built_in">document</span>.title = <span class="hljs-string">'Sign in'</span>
  }, [])</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We use controlled inputs for the form, allowing us to easily access their
current value, but also to normalize these on-the-fly.  It is important to
use an empty string instead of <code>undefined</code> for the default value, so the
inputs are always controlled.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> [email, setEmail] = useState(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> [password, setPassword] = useState(<span class="hljs-string">''</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We grab the info we need from the application state in the Redux store.
Here we&#39;re only interested in the <code>currentUser.loginState</code> value.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> loginState = useAppSelector((state) =&gt; state.currentUser.loginState)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>As we&#39;re about to ask the store to trigger sign-in, we need its <code>dispatch</code>
to send it our action.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> dispatch = useAppDispatch()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>We define a few flags and variable UI elements depending on the current
login state: logged-out, pending, logged-in or failure.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> loggingIn = loginState === <span class="hljs-string">'pending'</span>
  <span class="hljs-keyword">const</span> logInIcon = loggingIn ? <span class="hljs-literal">null</span> : &lt;ArrowForward /&gt;
  <span class="hljs-keyword">const</span> canLogIn =
    !loggingIn &amp;&amp; email !== <span class="hljs-string">''</span> &amp;&amp; password.trim().length &gt;= MIN_PASSWORD_LENGTH</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Explicit failures will show a
<a href="https://mui.com/material-ui/react-snackbar/">snackbar</a> at the bottom to
notify the user of the issue.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> snackBar =
    loginState === <span class="hljs-string">'failure'</span> ? (
      &lt;Snackbar message=<span class="hljs-string">'Invalid identifier or password'</span> open /&gt;
    ) : (
      <span class="hljs-string">''</span>
    )

  <span class="hljs-keyword">return</span> (
    &lt;form onSubmit={handleSubmit}&gt;
      &lt;Card className={classes.loginScreen}&gt;
        &lt;CardHeader title=<span class="hljs-string">'Goal Tracker'</span> subheader=<span class="hljs-string">'Sign in'</span> /&gt;
        &lt;CardContent&gt;
          &lt;TextField
            autoComplete=<span class="hljs-string">'home email'</span>
            fullWidth
            id=<span class="hljs-string">'email'</span>
            label=<span class="hljs-string">'E-mail'</span>
            margin=<span class="hljs-string">'normal'</span>
            name=<span class="hljs-string">'email'</span>
            onChange={(event) =&gt; setEmail(normalizeEmail(event.target.value))}
            placeholder=<span class="hljs-string">'my@email.tld'</span>
            required
            <span class="hljs-keyword">type</span>=<span class="hljs-string">'email'</span>
            value={email}
          /&gt;
          &lt;TogglablePasswordField
            autoComplete=<span class="hljs-string">'current-password'</span>
            fullWidth
            helperText={`${MIN_PASSWORD_LENGTH} caract√®res minimum`}
            id=<span class="hljs-string">'password'</span>
            label=<span class="hljs-string">'Password'</span>
            margin=<span class="hljs-string">'normal'</span>
            name=<span class="hljs-string">'password'</span>
            onChange={(event) =&gt; setPassword(event.target.value)}
            placeholder=<span class="hljs-string">'one heck of a password'</span>
            required
            value={password}
          /&gt;
        &lt;<span class="hljs-regexp">/CardContent&gt;
        &lt;CardActions style={{ display: 'flex', justifyContent: 'center' }}&gt;
          &lt;Button
            color='primary'
            disabled={!canLogIn}
            startIcon={logInIcon}
            type='submit'
            variant='contained'
          &gt;
            Sign in
          &lt;/</span>Button&gt;
        &lt;<span class="hljs-regexp">/CardActions&gt;
      &lt;/</span>Card&gt;
      {snackBar}
    &lt;<span class="hljs-regexp">/form&gt;
  )
</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Form submission handler, which switches to an API call instead.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleSubmit</span>(<span class="hljs-params">event: FormEvent</span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>First, prevent the default behavior for the <code>submit</code> event, which would
trigger a full-page server request.</p></div></div><div class="code"><div class="wrapper">    event.preventDefault()</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Ask the Redux store to handle this, using the proper Action Creator to
generate the action we then dispatch.</p></div></div><div class="code"><div class="wrapper">    dispatch(logIn({ email, password }))
  }
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Normalize e-mail values (used on-the-fly in the controlled input) by removing
whitespace and lowercasing anything before the &#39;@&#39;. (Believe it or not, the
later part is actually case-sensitive. Ugh.)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeEmail</span>(<span class="hljs-params">email: <span class="hljs-built_in">string</span></span>) </span>{
  <span class="hljs-keyword">return</span> email
    .replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">''</span>)
    .replace(<span class="hljs-regexp">/^[^@]+/</span>, (text) =&gt; text.toLowerCase())
}</div></div></div></div></body></html>