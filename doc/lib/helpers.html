<!DOCTYPE html><html lang="en"><head><title>lib/helpers</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="lib/helpers"><meta name="groc-project-path" content="src/lib/helpers.ts"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/lib/helpers.ts</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="helpers">Helpers</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> { differenceInCalendarDays, formatISO } from <span class="hljs-string">'date-fns'</span>

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Goal } from <span class="hljs-string">'../reducers/goals'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { TodaysProgress } from <span class="hljs-string">'../reducers/todaysProgress'</span>

<span class="hljs-keyword">const</span> FORMATTERS = {
  full: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">'en-GB'</span>, { dateStyle: <span class="hljs-string">'full'</span> }),
  medium: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.DateTimeFormat(<span class="hljs-string">'en-GB'</span>, { dateStyle: <span class="hljs-string">'long'</span> }),
}

<span class="hljs-keyword">type</span> FormatterKey = keyof <span class="hljs-keyword">typeof</span> FORMATTERS

<span class="hljs-keyword">const</span> SPECIAL_FORMATS = [<span class="hljs-string">'Today'</span>, <span class="hljs-string">'Yesterday'</span>]</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> export</span></p>
<p>Format a date in a “handy” way.</p>
<p>If a format is passed (as <code>String</code>), use it directly (this is what
TrackerScreen does, ofr instance, using the <code>&#39;medium&#39;</code> format), otherwise use
special texts for today and yesterday, and long formats otherwise.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>date can be a Date  or a  string.</strong><br/>(- The date to format)</p>
</li>
<li><p><strong>format is optional and can be a FormatterKey  or a  null.</strong><br/>(- The format)</p>
</li>
<li><p><strong>options is optional and must be an Object.</strong></p>
<ul>
<li><strong>options.refDate can be a Date  or a  string  and has a default value of new.</strong><br/>(Date()] - The date to use as a reference for distance computation in order to favor special formats, if available.)</li>
</ul>
</li>
</ul>
<p><strong>Returns a String</strong><br/>(The formatted date.)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatDate</span>(<span class="hljs-params">
  date: <span class="hljs-built_in">Date</span> | <span class="hljs-built_in">string</span>,
  format?: FormatterKey | <span class="hljs-literal">null</span>,
  { refDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(</span>) }: </span>{ refDate?: <span class="hljs-built_in">Date</span> | <span class="hljs-built_in">string</span> } = {}
) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> date === <span class="hljs-string">'string'</span>) {
    date = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(date)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> refDate === <span class="hljs-string">'string'</span>) {
    refDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(refDate)
  }
  <span class="hljs-keyword">if</span> (format) {
    <span class="hljs-keyword">return</span> FORMATTERS[format].format(date)
  }
  <span class="hljs-keyword">const</span> diff = differenceInCalendarDays(refDate, date)
  <span class="hljs-keyword">return</span> SPECIAL_FORMATS[diff] || FORMATTERS.full.format(date)
}</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> export</span></p>
<p>Computes today&#39;s total progress and the settings&#39; total goal value, so the
caller may for instance compute the overall progress rate, or the possible
lag-behind at the current time, etc.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>todaysProgress must be a TodaysProgress.</strong><br/>(- Today&#39;s progress)</p>
</li>
<li><p><strong>goals must be an Array of Goals.</strong><br/>(- Goal definitions)</p>
</li>
</ul>
<p><strong>Returns a { totalProgress: number, totalTarget: number </strong><br/>(} - Today&#39;s total progression and the cumulative goal target.)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDayCounts</span>(<span class="hljs-params">todaysProgress: TodaysProgress, goals: Goal[]</span>) </span>{
  <span class="hljs-keyword">let</span> [totalProgress, totalTarget] = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { id, target } of goals) {
    totalProgress += todaysProgress[id] || <span class="hljs-number">0</span>
    totalTarget += target
  }

  <span class="hljs-keyword">return</span> { totalProgress, totalTarget }
}</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> export</span></p>
<p>Formats a date as IO8601 (YYYY-MM-DD)</p>
<p>Parameters:</p>
<ul>
<li><strong>date must be a Date.</strong><br/>(- The date to format)</li>
</ul>
<p><strong>Returns a String</strong><br/>(The formatted date)</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isoDate</span>(<span class="hljs-params">date: <span class="hljs-built_in">Date</span></span>) </span>{
  <span class="hljs-keyword">return</span> formatISO(date, { representation: <span class="hljs-string">'date'</span> })
}</div></div></div></div></body></html>